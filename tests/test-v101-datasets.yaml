# vim: tabstop=4 shiftwidth=2 expandtab
# Tests for more than one dataset.
---
- name: default query
  skip: true
  descr: defining the default query
  query_metadata: &default_metadata
    includeDatasetResponses: HIT
    datasetIds:
      - GRCh38:beacon_test:2030-01-01
    assemblyId: GRCh38
  query: &default_query
    start: 16577043
    referenceBases: TG
    variantType: SNP
    referenceName: "22"

- name: test_datasets_info
  descr:
    Test that both datasets are shown in the info endpoint.
  target: &target_metadata
    assemblyId: GRCh38
    variantCount: 17
    callCount: 12
    sampleCount: 2504
  beacondata:
    datasets: &metadata
      - dataset: &dataset1
          <<: *target_metadata
          datasetId: GRCh38:beacon_test:2030-01-01
      - dataset: &dataset2
          <<: *target_metadata
          datasetId: GRCh38:beacon_test2:2030-01-01
  results:
    - property: datasets
      assert: length_eq
      count: 2
    - property: datasets
      assert: contains
      data:
        <<: *target_metadata
        id: GRCh38:beacon_test:2030-01-01
    - property: datasets
      assert: contains
      data:
        <<: *target_metadata
        id: GRCh38:beacon_test2:2030-01-01

- name: test_two_datasets
  descr:
    Test that both datasets respond.
  query:
    includeDatasetResponses: HIT
    assemblyId: GRCh38
    <<: *default_query
  beacondata:
    <<: *metadata
    variants:
      - variant: &variant1_search
          <<: *default_query
          datasetId: GRCh38:beacon_test:2030-01-01
          callCount: 5008
          variantCount: 17
          sampleCount: 2504
          exists: true
          alternateBases: AG
          frequency: 0.003394569
      - variant: &variant2_search
          <<: *default_query
          datasetId: GRCh38:beacon_test2:2030-01-01
          callCount: 5008
          variantCount: 17
          sampleCount: 2504
          exists: true
          alternateBases: AG
          frequency: 0.003394569
  results:
    - property: datasetAlleleResponses
      assert: length_gt
      length: 1
    - property: datasetAlleleResponses
      assert: contains
      data:
        <<: *variant1_search
        exists: true
    - property: datasetAlleleResponses
      assert: contains
      data:
        <<: *variant2_search
        exists: true

- name: test_second_datasets
  descr:
    Test that excluding a dataset works.
  query: &second_query
    <<: *default_metadata
    referenceName: "22"
    start: 16577043
    end: 16577045
    referenceBases: TG
    variantType: SNP
    datasetIds:
      - GRCh38:beacon_test2:2030-01-01
  beacondata:
    <<: *metadata
    variants:
      - variant: &variant_second
          <<: *second_query
          datasetId: GRCh38:beacon_test:2030-01-01
  results:
    - property: datasetAlleleResponses
      assert: length_eq
      count: 1
    - property: datasetAlleleResponses
      assert: not_contains
      data:
        datasetId: GRCh38:beacon_test:2030-01-01
