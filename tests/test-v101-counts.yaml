# vim: tabstop=4 shiftwidth=2 expandtab
# Example tests.
# Check that they work and that we get the expected output.
---
- name: test_info
  descr:
    Test the beacon's info (/) call.
  query: &default_query
    referenceName: 22
    referenceBases: GG
    alternateBases: N
    assemblyId: GRCh38
    start: 0
    end: 2
    includeDatasetResponses: HIT
    datasetIds:
      - GRCh38:beacon_test:2030-01-01
  results:
    - property: datasets
      assert: contains
      data:
        id: GRCh38:beacon_test:2030-01-01
        assemblyId: GRCh38
        variantCount: 17
        callCount: 12
        sampleCount: 2504

- name: test_search_1
  descr:
    Test a standard query with alternateBases, start and end.
  query:
    <<: *default_query
    start: 16050074
    end: 16050075
    referenceBases: A
    alternateBases: G
  results:
    - property: datasetAlleleResponses
      assert: contains
      data:
        datasetId: GRCh38:beacon_test:2030-01-01
        referenceName: 22
        callCount: 5008
        variantCount: 1
        sampleCount: 2504
        exists: true
        referenceBases: A
        alternateBases: G
        variantType: SNP
        frequency: 0.000199681

- name: test_snp
  descr:
    Test variantType SNP.
  query:
    <<: *default_query
    start: 17302971
    end: 17302972
    variantType: SNP
    referenceBases: C
    alternateBases: null
  results:
    - property: datasetAlleleResponses
      assert: contains
      data:
        datasetId: GRCh38:beacon_test:2030-01-01
        referenceName: 22
        callCount: 5008
        variantCount: 2931
        sampleCount: 2504
        exists: true
        referenceBases: C
        alternateBases: A
        variantType: SNP
        frequency: 0.585264

- name: test_bad_end
  descr:
    Test querying with a bad end position.
  query:
    <<: *default_query
    start: 17300407
    end: 17300409
    referenceBases: A
    alternateBases: G
  results:
    # FIXME: I'm unsure of how to formulate this.
    - property: datasetAlleleResponses
      assert: contains
      data:
        exists: null

- name: test_end
  descr:
    Test the same query as "test_bad_end" but with the correct end position.
  query:
    <<: *default_query
    start: 17300407
    end: 17300408
    referenceBases: A
    alternateBases: G
  results:
    - property: datasetAlleleResponses
      assert: contains
      data:
        datasetId: GRCh38:beacon_test:2030-01-01
        referenceName: 22
        callCount: 5008
        variantCount: 4723
        sampleCount: 2504
        exists: true
        referenceBases: A
        alternateBases: G
        variantType: SNP
        frequency: 0.943091

- name: test_insertion
  descr:
    Test variantTypes INS.
  query:
    <<: &default_query
    start: 16064512
    end: 16064513
    variantType: INS
    referenceBases: A
    alternateBases: null
  results:
    - property: datasetAlleleResponses
      assert: contains
      data:
        datasetId: GRCh38:beacon_test:2030-01-01
        referenceName: 22
        callCount: 5008
        variantCount: 21
        sampleCount: 2504
        exists: true
        referenceBases: A
        alternateBases: AAGAATGGCCTAATAC
        variantType: INS
        frequency: 0.00419329

- name: test_insertion_altbase
  descr:
    Test variantTypes by searching for ref and alt.
  query:
    <<: &default_query
    start: 16539540
    end: 16539541
    referenceBases: A
    alternateBases: AC
  results:
    - property: datasetAlleleResponses
      assert: contains
      data:
        datasetId: GRCh38:beacon_test:2030-01-01
        referenceName: 22
        callCount: 5008
        variantCount: 7
        sampleCount: 2504
        exists: true
        referenceBases: A
        alternateBases: AC
        variantType: INS
        frequency: 0.00139776
